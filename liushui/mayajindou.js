var data = [
    { uid : 2036557900, ver : 265, times : 4908 },
    { uid : 2036662275, ver : 265, times : 4530 },
    { uid : 2036435878, ver : 265, times : 4441 },
    { uid : 2036468921, ver : 265, times : 3503 },
    { uid : 2005738217, ver : 265, times : 2870 },
    { uid : 2036656463, ver : 265, times : 2527 },
    { uid : 2036697112, ver : 265, times : 2344 },
    { uid : 2036663224, ver : 265, times : 2283 },
    { uid : 2020628138, ver : 265, times : 2262 },
    { uid : 2036456533, ver : 265, times : 2128 },
    { uid : 2013488842, ver : 265, times : 2088 },
    { uid : 2032940304, ver : 265, times : 2015 },
    { uid : 2031572500, ver : 265, times : 1928 },
    { uid : 2036607478, ver : 265, times : 1852 },
    { uid : 2030206447, ver : 265, times : 1834 },
    { uid : 2036667005, ver : 265, times : 1678 },
    { uid : 2036431401, ver : 260, times : 1616 },
    { uid : 2006770257, ver : 265, times : 1567 },
    { uid : 2002038845, ver : 265, times : 1544 },
    { uid : 31228945, ver : 260, times : 1524 },
    { uid : 2036668470, ver : 265, times : 1463 },
    { uid : 2001729684, ver : 265, times : 1345 },
    { uid : 2036553794, ver : 265, times : 1311 },
    { uid : 2036480604, ver : 265, times : 1297 },
    { uid : 2036580255, ver : 265, times : 1147 },
    { uid : 26581428, ver : 265, times : 1131 },
    { uid : 2008592267, ver : 265, times : 1118 },
    { uid : 2016608219, ver : 265, times : 1072 },
    { uid : 2012950901, ver : 265, times : 1060 },
    { uid : 2036680543, ver : 265, times : 1051 },
    { uid : 2036699317, ver : 230, times : 1048 },
    { uid : 2016071502, ver : 265, times : 1022 },
    { uid : 2022211095, ver : 265, times : 1020 },
    { uid : 2036504875, ver : 265, times : 1009 },
    { uid : 2036528388, ver : 265, times : 1008 },
    { uid : 2036697032, ver : 265, times : 983 },
    { uid : 2014791500, ver : 265, times : 974 },
    { uid : 2036688236, ver : 265, times : 946 },
    { uid : 2036574760, ver : 265, times : 921 },
    { uid : 2014653465, ver : 265, times : 891 },
    { uid : 2036560398, ver : 265, times : 856 },
    { uid : 2032890756, ver : 265, times : 821 },
    { uid : 2036658416, ver : 265, times : 808 },
    { uid : 2036691619, ver : 265, times : 772 },
    { uid : 2032580816, ver : 265, times : 735 },
    { uid : 2036566109, ver : 265, times : 729 },
    { uid : 2011128794, ver : 265, times : 710 },
    { uid : 2036689807, ver : 265, times : 701 },
    { uid : 2036512467, ver : 265, times : 688 },
    { uid : 2036686331, ver : 265, times : 656 },
    { uid : 2017383461, ver : 265, times : 615 },
    { uid : 2036682740, ver : 265, times : 577 },
    { uid : 2036607610, ver : 265, times : 519 },
    { uid : 2036685158, ver : 265, times : 497 },
    { uid : 14471606, ver : 265, times : 490 },
    { uid : 2036653882, ver : 265, times : 442 },
    { uid : 2036638243, ver : 265, times : 433 },
    { uid : 2021001033, ver : 265, times : 401 },
    { uid : 2036507435, ver : 265, times : 369 },
    { uid : 2022776392, ver : 260, times : 366 },
    { uid : 2036652305, ver : 265, times : 332 },
    { uid : 2019286337, ver : 265, times : 291 },
    { uid : 2008587677, ver : 246, times : 248 },
    { uid : 8644059, ver : 265, times : 219 },
    { uid : 2036689048, ver : 265, times : 216 },
    { uid : 32949811, ver : 265, times : 215 },
    { uid : 2022527563, ver : 265, times : 214 },
    { uid : 2036709197, ver : 265, times : 195 },
    { uid : 2033819911, ver : 265, times : 194 },
    { uid : 2017096776, ver : 265, times : 178 },
    { uid : 2036468244, ver : 265, times : 156 },
    { uid : 2036431531, ver : 260, times : 150 },
    { uid : 2036443030, ver : 265, times : 149 },
    { uid : 2036615855, ver : 265, times : 148 },
    { uid : 2036429290, ver : 265, times : 147 },
    { uid : 2036420979, ver : 260, times : 147 },
    { uid : 2032437572, ver : 265, times : 144 },
    { uid : 2036459226, ver : 265, times : 142 },
    { uid : 2033258583, ver : 265, times : 140 },
    { uid : 2019839415, ver : 231, times : 136 },
    { uid : 2030241937, ver : 265, times : 107 },
    { uid : 2021615648, ver : 265, times : 106 },
    { uid : 2036713324, ver : 265, times : 106 },
    { uid : 2036646848, ver : 260, times : 102 },
    { uid : 2036693324, ver : 265, times : 100 },
    { uid : 2036499603, ver : 265, times : 99 },
    { uid : 2018526474, ver : 265, times : 99 },
    { uid : 20678890, ver : 265, times : 97 },
    { uid : 2009596530, ver : 265, times : 96 },
    { uid : 2036700326, ver : 230, times : 95 },
    { uid : 2036414548, ver : 265, times : 92 },
    { uid : 2036680884, ver : 265, times : 92 },
    { uid : 2008480090, ver : 236, times : 92 },
    { uid : 2036625593, ver : 265, times : 92 },
    { uid : 2004076656, ver : 265, times : 85 },
    { uid : 2036594632, ver : 265, times : 83 },
    { uid : 28477217, ver : 265, times : 82 },
    { uid : 2036706311, ver : 265, times : 81 },
    { uid : 19808574, ver : 265, times : 71 },
    { uid : 2023762242, ver : 265, times : 70 },
    { uid : 2036471469, ver : 265, times : 68 },
    { uid : 2036623507, ver : 265, times : 67 },
    { uid : 2036544067, ver : 265, times : 64 },
    { uid : 2036621115, ver : 265, times : 62 },
    { uid : 2000311127, ver : 265, times : 61 },
    { uid : 2011644030, ver : 265, times : 56 },
    { uid : 2036665806, ver : 265, times : 54 },
    { uid : 15345630, ver : 260, times : 53 },
    { uid : 2036422778, ver : 265, times : 52 },
    { uid : 2007317420, ver : 265, times : 51 },
    { uid : 2036684148, ver : 265, times : 47 },
    { uid : 2036503249, ver : 265, times : 46 },
    { uid : 2036561408, ver : 265, times : 46 },
    { uid : 2036524102, ver : 265, times : 40 },
    { uid : 2036526219, ver : 265, times : 37 },
    { uid : 2036600539, ver : 265, times : 37 },
    { uid : 2036662317, ver : 265, times : 36 },
    { uid : 2001366733, ver : 265, times : 35 },
    { uid : 2033676891, ver : 265, times : 33 },
    { uid : 2015260592, ver : 265, times : 32 },
    { uid : 2022459603, ver : 265, times : 29 },
    { uid : 2010023716, ver : 260, times : 29 },
    { uid : 2021843815, ver : 265, times : 28 },
    { uid : 2023320778, ver : 265, times : 27 },
    { uid : 2036538709, ver : 265, times : 26 },
    { uid : 2036712765, ver : 265, times : 25 },
    { uid : 2036497521, ver : 265, times : 24 },
    { uid : 2036538887, ver : 265, times : 24 },
    { uid : 21302740, ver : 265, times : 21 },
    { uid : 2015701683, ver : 265, times : 21 },
    { uid : 2007391199, ver : 265, times : 21 },
    { uid : 2036618245, ver : 265, times : 20 },
    { uid : 2036410127, ver : 265, times : 20 },
    { uid : 2036621032, ver : 265, times : 20 },
    { uid : 2022536529, ver : 260, times : 20 },
    { uid : 2023398328, ver : 236, times : 19 },
    { uid : 2023776483, ver : 265, times : 17 },
    { uid : 2036609782, ver : 265, times : 16 },
    { uid : 2036681580, ver : 265, times : 15 },
    { uid : 2021154540, ver : 265, times : 15 },
    { uid : 2003575583, ver : 265, times : 14 },
    { uid : 2036635328, ver : 265, times : 13 },
    { uid : 33664418, ver : 265, times : 11 },
    { uid : 2036525172, ver : 265, times : 10 },
    { uid : 2014570215, ver : 265, times : 10 },
    { uid : 2022354765, ver : 260, times : 10 },
    { uid : 2036724309, ver : 265, times : 10 },
    { uid : 14395927, ver : 265, times : 9 },
    { uid : 2024939164, ver : 265, times : 9 },
    { uid : 10793230, ver : 170, times : 9 },
    { uid : 2008372421, ver : 193, times : 9 },
    { uid : 2012124924, ver : 265, times : 9 },
    { uid : 2017225269, ver : 265, times : 9 },
    { uid : 26622159, ver : 265, times : 8 },
    { uid : 6513799, ver : 265, times : 8 },
    { uid : 2024901891, ver : 265, times : 8 },
    { uid : 2015150042, ver : 260, times : 8 },
    { uid : 2020681631, ver : 265, times : 8 },
    { uid : 2036585132, ver : 265, times : 7 },
    { uid : 14481763, ver : 265, times : 7 },
    { uid : 2036477991, ver : 265, times : 7 },
    { uid : 2036473271, ver : 265, times : 6 },
    { uid : 2036668242, ver : 265, times : 6 },
    { uid : 2036528477, ver : 265, times : 6 },
    { uid : 2024745393, ver : 265, times : 6 },
    { uid : 2019684507, ver : 265, times : 6 },
    { uid : 2021791743, ver : 265, times : 5 },
    { uid : 2033819911, ver : 260, times : 5 },
    { uid : 2036571703, ver : 265, times : 5 },
    { uid : 2008413736, ver : 265, times : 5 },
    { uid : 12799509, ver : 265, times : 5 },
    { uid : 14016547, ver : 260, times : 5 },
    { uid : 2009027825, ver : 265, times : 5 },
    { uid : 2036677119, ver : 265, times : 5 },
    { uid : 2036560811, ver : 265, times : 5 },
    { uid : 29697570, ver : 265, times : 5 },
    { uid : 2036684585, ver : 265, times : 4 },
    { uid : 2036451919, ver : 265, times : 4 },
    { uid : 2036633956, ver : 265, times : 4 },
    { uid : 2024285055, ver : 265, times : 4 },
    { uid : 2036450172, ver : 265, times : 4 },
    { uid : 2007926900, ver : 265, times : 4 },
    { uid : 32183058, ver : 260, times : 4 },
    { uid : 2036636055, ver : 265, times : 4 },
    { uid : 2036546366, ver : 265, times : 4 },
    { uid : 2036696633, ver : 265, times : 4 },
    { uid : 2036647233, ver : 265, times : 4 },
    { uid : 2018854624, ver : 265, times : 4 },
    { uid : 2022965864, ver : 260, times : 4 },
    { uid : 2036512611, ver : 260, times : 4 },
    { uid : 2036461059, ver : 265, times : 3 },
    { uid : 16447319, ver : 265, times : 3 },
    { uid : 22934184, ver : 265, times : 3 },
    { uid : 2036464999, ver : 265, times : 3 },
    { uid : 24449618, ver : 265, times : 3 },
    { uid : 2036673853, ver : 265, times : 3 },
    { uid : 2036414125, ver : 265, times : 3 },
    { uid : 2020037944, ver : 265, times : 3 },
    { uid : 2011882378, ver : 265, times : 3 },
    { uid : 2003060610, ver : 265, times : 3 },
    { uid : 2036658100, ver : 265, times : 3 },
    { uid : 2031733517, ver : 265, times : 3 },
    { uid : 2036664407, ver : 265, times : 2 },
    { uid : 2036660218, ver : 265, times : 2 },
    { uid : 2036694234, ver : 265, times : 2 },
    { uid : 2036652826, ver : 265, times : 2 },
    { uid : 2036628793, ver : 265, times : 2 },
    { uid : 2021994525, ver : 265, times : 2 },
    { uid : 2036568340, ver : 265, times : 2 },
    { uid : 7001217, ver : 265, times : 2 },
    { uid : 2005447864, ver : 265, times : 2 },
    { uid : 2023449116, ver : 265, times : 2 },
    { uid : 22903617, ver : 265, times : 2 },
    { uid : 2036529692, ver : 265, times : 2 },
    { uid : 2015651225, ver : 265, times : 2 },
    { uid : 2036616675, ver : 265, times : 2 },
    { uid : 2036708669, ver : 265, times : 2 },
    { uid : 2036474278, ver : 265, times : 2 },
    { uid : 13338196, ver : 265, times : 2 },
    { uid : 2036410479, ver : 265, times : 2 },
    { uid : 2036501839, ver : 265, times : 2 },
    { uid : 2017219199, ver : 265, times : 2 },
    { uid : 2036682235, ver : 265, times : 2 },
    { uid : 888484, ver : 265, times : 2 },
    { uid : 2017585613, ver : 265, times : 2 },
    { uid : 2013329578, ver : 265, times : 2 },
    { uid : 2001928045, ver : 265, times : 2 },
    { uid : 22654696, ver : 265, times : 2 },
    { uid : 2021244963, ver : 265, times : 2 },
    { uid : 2014086424, ver : 265, times : 2 },
    { uid : 2022755908, ver : 265, times : 2 },
    { uid : 2003397137, ver : 265, times : 2 },
    { uid : 11165551, ver : 265, times : 2 },
    { uid : 2019835575, ver : 265, times : 2 },
    { uid : 2023504126, ver : 265, times : 2 },
    { uid : 2009632188, ver : 265, times : 2 },
    { uid : 2015769189, ver : 265, times : 2 },
    { uid : 2036717565, ver : 265, times : 2 },
    { uid : 2002674148, ver : 265, times : 2 },
    { uid : 2022768784, ver : 260, times : 2 },
    { uid : 2010509277, ver : 265, times : 2 },
    { uid : 2036692431, ver : 265, times : 2 },
    { uid : 2014572880, ver : 260, times : 2 },
    { uid : 2020993111, ver : 265, times : 2 },
    { uid : 2036639878, ver : 265, times : 2 },
    { uid : 2015096145, ver : 265, times : 2 },
    { uid : 2036575236, ver : 265, times : 2 },
    { uid : 2010997622, ver : 265, times : 2 },
    { uid : 2036626989, ver : 265, times : 2 },
    { uid : 2014088117, ver : 265, times : 2 }
]

var gifts = [
    { item_id : 0,    num : 100000, name : '金豆' },
    // { item_id : 1000, num : 30,     name : 'vip1' },
    // { item_id : 1011, num : 3,      name : '记牌器' },
    // { item_id : 5106, num : 3,      name : '齐天圣君（发型）' },
    // { item_id : 5206, num : 3,      name : '齐天圣君（面部）' },
    // { item_id : 5306, num : 3,      name : '齐天圣君（衣服）' },
    // { item_id : 5407, num : 3,      name : '齐天圣君（装饰）' }
]

var need_send = []

for(var i = 0; i < data.length; i++) {
    data[i].items = []
    need_send.push(data[i])
    for(var j = 0; j < gifts.length; j++) {
        data[i].items.push({
            item_id : gifts[j].item_id,
            num     : gifts[j].num
        })
    }
}

if(process.platform == 'win32') {
    var async        = require('D:\\code\\node_modules\\async')
    var http_request = require('D:\\code\\node_webs\\node_modules\\http_request')
} else {
    var async        = require('/root/code/node_modules/async')
    var http_request = require('/root/code/node_webs/node_modules/http_request')
}

function go() {
    var t = need_send
    // t[0].times = 3
    // t[1].times = 5
    async.eachSeries(t, function(u, cb) {
        try_send_one(u, cb)
    }, function(err) {
        console.log('ai..........')
    })
}

function try_send_one(u, callback) {
    console.log('try_send_one:', u)
    async.timesSeries(u.times - 1, function(n, cb) {
        send_one(u, n, cb)
    }, function(err) {
        console.log('try_send_one result:', err ? err : 'ok')
        callback()
    })
}

var url = 'http://172.21.0.11:8000/props'
function send_one(u, n, callback) {
    console.log('send_one:', u, n)
    async.eachSeries(u.items, function(item, cb) {
        var args = {
            source     : 4,
            items      : item.item_id + '|' + -item.num,
            uid        : u.uid,
            chn        : '02',
            servercode : u.ver
        }
        console.log('send_msg_to_gs', url, args)
        http_request.get(url, args, function(err, ret) {
            console.log('send_msg_to_gs result ', ret)

            if (err) {
                console.error('send_msg_to_gs fail ', err, ret)
                cb(err); return
            }

            if(ret.result) {
                cb(ret.result)
                return
            }

            cb()
        }, 'json') 
    }, function(err) {
        callback(err)
    })
}
go()
